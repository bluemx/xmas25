<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feliz Navidad - Blue Pure Loyalty</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Muli:400,700|Open+Sans+Condensed:700&display=swap"
        rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/audio.css">
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Lenis Smooth Scroll -->
    <script src="https://unpkg.com/lenis@1.1.20/dist/lenis.min.js"></script>
    <!-- Matter.js Physics -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    
</head>

<body>
    <div id="app">
        <!-- Snow Canvas -->
        <canvas id="snow-canvas"></canvas>
        <!-- Fireworks Canvas -->
        <canvas id="fireworks-canvas"></canvas>
        
        <!-- Whole Page Container -->
        <div class="whole-container">
        
        <!-- Postal Container with Scroll Track -->
        <div class="postal-container">
            <!-- Main Scroll Track -->
            <div class="scroll-track" ref="scrollTrack"></div>

            <!-- Sticky Postal Scene -->
            <div class="postal-scene" :style="postalSceneStyle">
            <div class="flip-wrapper" :class="{ 'is-flipped': hasStarted }">

                <!-- Front Side: Loader / Intro -->
                <div class="loader-card">
                    <div class="flex flex-col items-center justify-center h-full w-full p-8 text-center">
                        <img src="assets/bcircle.svg" alt="Blue" class="w-32 h-32 mb-8 animate-pulse">

                        <!-- Loading State -->
                        <div v-if="!isReady"
                            class="text-white text-xl font-light tracking-widest flex flex-col items-center">
                            <span class="mb-2">CARGANDO</span>
                            <div class="w-32 h-1 bg-white/20 rounded-full overflow-hidden">
                                <div class="h-full bg-cyan-400 transition-all duration-300"
                                    :style="{ width: loadingProgress + '%' }"></div>
                            </div>
                        </div>

                        <!-- Ready State -->
                        <button v-else @click="startExperience" class="start-btn group">
                            <span class="text-xl tracking-widest uppercase">Iniciar</span>
                            <div class="w-0 group-hover:w-full h-[1px] bg-cyan-400 transition-all duration-300 mt-1">
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Back Side: Postal Content -->
                <div class="postal-card" ref="postalCard" :style="cardStyle">

                    <!-- Image Sequence Canvas -->
                    <canvas ref="sequenceCanvas" class="sequence-canvas" width="1680" height="1920"></canvas>

                    <!-- Overlays -->

                    <!-- Logo Top -->
                    <div class="overlay-logo" :style="{ opacity: showLogo ? 1 : 0 }">
                        <img src="assets/BluePureLoyalty.svg" alt="Blue Pure Loyalty" class="w-full h-auto">
                    </div>

                    <!-- Text 1 Middle -->
                    <div class="overlay-text"
                        :style="{ opacity: showText1 ? 1 : 0, top: '50%', transform: 'translateY(-50%)' }">
                        <p>Te deseamos salud y alegría<br>en compañía de tus seres queridos.</p>
                    </div>

                    <!-- Text 2 Bottom -->
                    <div class="overlay-text" :style="{ opacity: showText2 ? 1 : 0, bottom: '5%' }">
                        <p>¡Feliz Navidad y un 2026 lleno de lealtad!</p>
                    </div>
                </div>
            </div>
            </div>

            <!-- Scroll Hint -->
            <div class="scroll-hint"
                :class="{ 'opacity-0': scrollProgress > 0.02 || !hasStarted, 'opacity-100': hasStarted && scrollProgress <= 0.02 }">
                <div class="mouse-icon hidden md:block">
                    <div class="wheel"></div>
                </div>
                <div class="hand-icon md:hidden">
                    <svg viewBox="0 0 24 24" fill="white" width="30" height="30">
                        <path
                            d="M12 2C8.13 2 5 5.13 5 9v6c0 3.87 3.13 7 7 7s7-3.13 7-7V9c0-3.87-3.13-7-7-7zm0 18c-2.76 0-5-2.24-5-5V9c0-2.76 2.24-5 5-5s5 2.24 5 5v6c0 2.76-2.24 5-5 5z" />
                        <path d="M11 6h2v5h-2z" class="animate-bounce" />
                    </svg>
                </div>
                <p class="mt-2 text-sm tracking-widest uppercase">Haz Scroll</p>
            </div>
        </div>
        <!-- End Postal Container -->

        <blue-pleca></blue-pleca>

        <!-- Galletízate Section - Natural Scroll -->
        <div class="galletizate-container w-full bg-gradient-to-b from-black/50 to-black py-16">
            <div class="max-w-6xl mx-auto px-4 md:px-6">
                <div class="galletizate-content">

                    <!-- 1. Upload View -->
                    <div v-if="!isCooking && !cookieResult" class="fade-enter-active">
                        <h2 class="text-2xl md:text-3xl font-bold mb-2 text-cyan-400 font-muli text-center">¡Galletízate!</h2>
                        <p class="text-sm md:text-base mb-4 max-w-md mx-auto text-center">Agrega tu foto y conviértete en una galleta de jengibre.</p>

                        <div class="upload-container mb-3">
                            <input type="file" ref="fileInput" accept="image/*" class="hidden"
                                @change="handleFileUpload">

                            <div v-if="!userPhoto" @click="triggerFileInput"
                                class="border-2 border-dashed border-cyan-400/50 rounded-lg p-8 hover:bg-cyan-900/20 transition-colors flex flex-col items-center cursor-pointer max-w-md mx-auto">
                                <svg class="w-10 h-10 text-cyan-400 mb-1" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                    </path>
                                </svg>
                                <span class="text-cyan-400 font-semibold text-sm">Subir Foto</span>
                            </div>

                            <div v-else class="flex items-center justify-center gap-3 flex-wrap">
                                <div class="relative w-16 h-16 rounded-lg overflow-hidden border-2 border-cyan-400 shadow-lg shadow-cyan-500/20 flex-shrink-0">
                                    <img :src="userPhoto" class="w-full h-full object-cover">
                                </div>
                                <button @click="triggerFileInput"
                                    class="text-cyan-400 hover:text-cyan-300 text-xs underline">
                                    Cambiar foto
                                </button>
                                <button @click="sendImage"
                                    class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transform transition hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-sm"
                                    :disabled="isSending">
                                    <span>Generar Galleta</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Cooking View - Circular Overlay -->
                    <div v-if="isCooking"
                        class="cooking-view fixed inset-0 z-[105] flex items-center justify-center pointer-events-none bg-black/60">
                        <div class="relative w-80 h-80 rounded-full overflow-hidden shadow-2xl">
                            <video src="assets/cooking.mp4" autoplay loop muted playsinline
                                class="w-full h-full object-cover"></video>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <p class="text-4xl md:text-5xl font-bold text-yellow-400 font-muli drop-shadow-lg animate-pulse">Horneando...</p>
                        </div>
                    </div>

                    <!-- 3. Result View - Static Cookie for Saving -->
                    <div v-if="cookieResult" class="result-view flex flex-col items-center animate-pop-in">
                        <h2 class="text-3xl md:text-4xl font-bold mb-3 text-yellow-400 font-muli drop-shadow-md text-center">
                            ¡Galleta Lista!</h2>

                        <div
                            class="relative w-56 h-56 md:w-64 md:h-64 mb-4 transform hover:scale-105 transition duration-500">
                            <!-- Glow effect -->
                            <div class="absolute inset-0 bg-yellow-400/20 blur-xl rounded-full animate-pulse"></div>
                            <img :src="cookieResult" class="w-full h-full object-contain relative z-10 drop-shadow-2xl">
                        </div>

                        <p class="text-white/80 mb-2 text-sm text-center">¡Tu versión más dulce está lista!</p>
                    </div>

                    <!-- Physics Gallery -->
                    <div v-if="showPhysicsGallery" class="w-full mt-8">
                        <h3 class="text-xl font-bold text-white mb-2 text-center">Galería de Galletas</h3>
                        <p class="text-white/60 text-xs text-center mb-3">¡Mueve las galletas! Arrastra y suelta.</p>
                        <div class="relative w-full pointer-events-none bg-cover bg-center rounded-lg overflow-hidden" :style="{ height: physicsHeight, backgroundImage: 'url(assets/physicsbg.avif)' }">
                            <canvas ref="physicsCanvas" class="w-full h-full block cursor-grab active:cursor-grabbing" style="pointer-events: auto; touch-action: manipulation;" data-qr-disabled="true"></canvas>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        
        </div> <!-- End Whole Container -->

        <!-- Audio Player -->
        <div class="audio-player" v-if="audioLoaded" :class="{ 'opacity-100': true, 'opacity-0': false }">
            <button class="play-btn" @click="toggleAudio">
                <span v-if="isPlaying">❚❚</span>
                <span v-else>▶</span>
            </button>
            <div class="progress-container" @click="seekAudio">
                <div class="progress-bar" :style="{ width: audioProgress + '%' }"></div>
            </div>
        </div>
        <!-- Debug Info (Optional, remove in prod) -->
        <!-- <div class="fixed top-0 right-0 p-2 bg-black text-white text-xs">
            {{ (scrollProgress * 100).toFixed(1) }}%
            <br>
            Mouse: {{ mouseX }}, {{ mouseY }}
        </div> -->
    </div>

    <script src="js/app.js"></script>

    <script src="https://unpkg.com/@bluemx/blue-components"></script>


    <div class="bg-white">
    <blue-footer></blue-footer>
    </div>

</body>

</html>